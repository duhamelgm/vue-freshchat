!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global=global||self,global.VueFreshchat=factory())}(this,function(){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}var Vue,callIf=function(a,f){return a&&f()},assert=function(condition,msg){return callIf(!condition,function(){throw new Error("[vue-freshchat] ".concat(msg))})},mapInstanceToProps=function(vm,props){var o={};return props.forEach(function(p){return o[p]={get:function(){return vm[p]}}}),o},VueFreshchat={},getFreshchatInstance=function(_ref){var appToken=_ref.appToken,host=_ref.host;assert(Vue,"call Vue.use(VueFreshchat) before creating an instance");var vm=new Vue({data:function(){return{ready:!1,isOpen:!1,hideWidget:!1,externalId:null,user:{},dom:null}},watch:{isOpen:function(){this.hideWidget&&this.onHideWidget()},hideWidget:function(){if(!this.hideWidget)return void(this.dom.style.display="block");this.onHideWidget()},dom:function(){this.hideWidget&&this.onHideWidget()}},methods:{onHideWidget:function(){this.dom&&(this.isOpen?this.dom.style.display="block":this.dom.style.display="none")}}}),freshchat={_vm:vm};return Object.defineProperties(freshchat,mapInstanceToProps(vm,["ready","isOpen"])),freshchat._init=function(){vm.ready=!0,freshchat._boot()},freshchat._boot=function(){window.fcWidget.init({token:appToken,host:null!==host&&void 0!==host?host:"https://wchat.freshchat.com"}),window.fcWidget.setExternalId(vm.externalId),window.fcWidget.user.setMeta(vm.user),window.fcWidget.on("widget:opened",function(){vm.isOpen=!0}),window.fcWidget.on("widget:closed",function(){vm.isOpen=!1}),vm.dom=document.querySelector("#fc_frame")},freshchat.setExternalId=function(externalId){vm.externalId=externalId,vm.ready&&window.fcWidget.setExternalId(vm.externalId)},freshchat.setUserProperties=function(){var user=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};vm.user=_objectSpread2(_objectSpread2({},vm.user),user),vm.ready&&window.fcWidget.user.setProperties(vm.user)},freshchat.open=function(payload){vm.ready&&window.fcWidget.open(payload)},freshchat.close=function(){vm.ready&&window.fcWidget.close()},freshchat.toggle=function(){vm.isOpen?freshchat.close():freshchat.open()},freshchat.hideWidget=function(){vm.hideWidget=!0},freshchat};VueFreshchat.loadScript=function(done){var script=document.createElement("script");script.async=!0,script.src="https://wchat.freshchat.com/js/widget.js";var firstScript=document.getElementsByTagName("script")[0];firstScript.parentNode.insertBefore(script,firstScript),script.onload=done};var installed;return VueFreshchat.install=function(_Vue,_ref2){var appToken=_ref2.appToken,host=_ref2.host;assert(!Vue,"already installed."),Vue=_Vue;var vueFreshchat=getFreshchatInstance({appToken:appToken,host:host});Vue.mixin({mounted:function(){var _this=this;if(!installed){if(installed=!0,"function"==typeof window.fcWidget)return void this.$freshchat._init();var loaded=function(){return VueFreshchat.loadScript(function(){return _this.$freshchat._init()})};"complete"===document.readyState?loaded():window.attachEvent?window.attachEvent("onload",loaded):window.addEventListener("load",loaded,!1)}}}),Object.defineProperty(Vue.prototype,"$freshchat",{get:function(){return vueFreshchat}})},VueFreshchat});
